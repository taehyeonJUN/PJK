<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mem">

	<select id="memLogin" resultType="MemberVo" parameterType="MemberVo">
	SELECT MEMNO,MEMID, MEMPASS, MEMNAME, MEMJOINDATE, MEMAUTHOR
		  FROM PJK_MEMBER 
		  WHERE memid = #{memId} 
		  		AND memPass = #{memPass} 
		  		AND MEMCHECKDEL = 'N'
	</select>

	<select id="memList" resultType="MemberVo">
	SELECT MEMNO,MEMID, MEMPASS, MEMNAME, MEMJOINDATE, MEMAUTHOR
	FROM PJK_MEMBER
	WHERE MEMCHECKDEL = 'N'
	</select>

	<select id="memSeletOne" parameterType="MemberVo" resultType="MemberVo">
	SELECT MEMNO, MEMID, MEMPASS, MEMNAME, MEMJOINDATE, MEMAUTHOR
	  FROM PJK_MEMBER
	 WHERE MEMCHECKDEL = 'N' AND MEMID = #{memId}
	</select>

	<update id="memEdit1" parameterType="MemberVo">
		UPDATE PJK_MEMBER
		SET MEMCHECKDEL = 'Y'
		WHERE MEMID = #{memId} AND MEMCHECKDEL = 'N'
	</update>

	<insert id="memEdit2" parameterType="MemberVo">
	
		<selectKey keyProperty="memNo" resultType="String" order="BEFORE">
		SELECT SEQ_MEMNO.NEXTVAL FROM DUAL
		</selectKey>

		INSERT INTO PJK_MEMBER(MEMNO,MEMID,MEMPASS,MEMNAME,memCount,MEMJOINDATE)
		VALUES(#{memNo},#{memId},#{memPass},#{memName},(
											SELECT MAX(memCount)
											  FROM PJK_MEMBER
										  	 WHERE memid = #{memId} AND memCheckDel = 'Y')+1,(SELECT Min(MEMJOINDATE) 
										  													FROM PJK_MEMBER 
										  													WHERE memid = #{memId}))
	</insert>
	
	
<!-- 	회원가입 -->
	<insert id="memJoin" parameterType="MemberVo">
	
		<selectKey keyProperty="memNo" resultType="String" order="BEFORE">
		SELECT SEQ_MEMNO.NEXTVAL FROM DUAL
		</selectKey>
		
		INSERT INTO PJK_MEMBER(MEMNO,MEMID,MEMPASS,MEMNAME) 
	  		 VALUES(#{memNo}, #{memId}, #{memPass}, #{memName})
	</insert>
	
<!-- 계정탈퇴 - 논리 -->
	<update id="memDel" parameterType="MemberVo">
		
		UPDATE PJK_MEMBER
		   SET MEMCHECKDEL = 'Y' , memCount = memCount + 1
		 WHERE MEMID = #{memId} AND MEMCHECKDEL = 'N'

	</update>
	
	<select id = "memChk" parameterType="MemberVo" resultType="int">
		SELECT COUNT(*) FROM PJK_MEMBER WHERE MEMID = #{memId}
	</select>
	
</mapper>